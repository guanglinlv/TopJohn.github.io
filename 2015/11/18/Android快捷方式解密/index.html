
 <!DOCTYPE HTML>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  
    <title>Android快捷方式解密 | TopJohn&#39;Blog</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <meta name="author" content="John">
    

    
    <meta name="description" content="Android快捷方式作为Android设备的杀手锏技能，一直都是非常重要的一个功能，也正是如此，各种流氓App也不断通过快捷方式霸占着这样一个用户入口。">
<meta property="og:type" content="article">
<meta property="og:title" content="Android快捷方式解密">
<meta property="og:url" content="http://www.xuanzhangjiong.xyz/2015/11/18/Android快捷方式解密/index.html">
<meta property="og:site_name" content="TopJohn'Blog">
<meta property="og:description" content="Android快捷方式作为Android设备的杀手锏技能，一直都是非常重要的一个功能，也正是如此，各种流氓App也不断通过快捷方式霸占着这样一个用户入口。">
<meta property="og:image" content="http://7xoz2q.com1.z0.glb.clouddn.com/Android%E5%BF%AB%E6%8D%B7%E6%96%B9%E5%BC%8F1.jpeg">
<meta property="og:image" content="http://7xoz2q.com1.z0.glb.clouddn.com/Android%E5%BF%AB%E6%8D%B7%E6%96%B9%E5%BC%8F2.jpeg">
<meta property="og:updated_time" content="2016-01-08T10:36:38.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Android快捷方式解密">
<meta name="twitter:description" content="Android快捷方式作为Android设备的杀手锏技能，一直都是非常重要的一个功能，也正是如此，各种流氓App也不断通过快捷方式霸占着这样一个用户入口。">
<link rel="publisher" href="114979210024559900000">

    
    <link rel="alternative" href="/atom.xml" title="TopJohn&#39;Blog" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/apple.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/apple.jpg">
    
    <link rel="stylesheet" href="/css/style.css" type="text/css">
</head>

  <body>
    <header>
      
<div>
		
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="TopJohn&#39;Blog">TopJohn&#39;Blog</a></h1>
				<h2 class="blog-motto">Coding的路上，至少我乐在其中...</h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="菜单">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">主页</a></li>
					
						<li><a href="/archives">归档</a></li>
					
						<li><a href="/categories">分类</a></li>
					
						<li><a href="/tags">标签</a></li>
					
						<li><a href="/pay">打赏</a></li>
					
						<li><a href="/about">关于</a></li>
					
					<li>
 					
					<form class="search" action="//google.com/search" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="search" id="search" name="q" autocomplete="off" maxlength="20" placeholder="搜索" />
						<input type="hidden" name="q" value="site:www.xuanzhangjiong.xyz">
					</form>
					
					</li>
				</ul>
			</nav>			
</div>
    </header>
    <div id="container">
      <div id="main" class="post" itemscope itemprop="blogPost">
  
	<article itemprop="articleBody"> 
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/11/18/Android快捷方式解密/" title="Android快捷方式解密" itemprop="url">Android快捷方式解密</a>
  </h1>
  <p class="article-author">By
       
		<a href="https://plus.google.com/114979210024559900000?rel=author" title="John" target="_blank" itemprop="author">John</a>
		
  <p class="article-time">
    <time datetime="2015-11-18T08:20:14.000Z" itemprop="datePublished"> 发表于 2015-11-18</time>
    
  </p>
</header>
	<div class="article-content">
		
		<div id="toc" class="toc-article">
			<strong class="toc-title">文章目录</strong>
		
			<ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Android_u5FEB_u6377_u65B9_u5F0F_u89E3_u5BC6"><span class="toc-number">1.</span> <span class="toc-text">Android快捷方式解密</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#u521B_u5EFA_u5FEB_u6377_u65B9_u5F0F_u4E4B_u2014_u2014_u5C11_u6797_u6D3E"><span class="toc-number">2.</span> <span class="toc-text">创建快捷方式之——少林派</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#u6743_u9650_u8BBE_u7F6E"><span class="toc-number">3.</span> <span class="toc-text">权限设置</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#u521B_u5EFA_u5FEB_u6377_u65B9_u5F0F"><span class="toc-number">4.</span> <span class="toc-text">创建快捷方式</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#u5220_u9664_u5FEB_u6377_u65B9_u5F0F"><span class="toc-number">5.</span> <span class="toc-text">删除快捷方式</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#u521B_u5EFA_u5FEB_u6377_u65B9_u5F0F_u4E4B_u2014_u2014_u900D_u9065_u6D3E"><span class="toc-number">6.</span> <span class="toc-text">创建快捷方式之——逍遥派</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#u5FEB_u6377_u65B9_u5F0F_u7684_u5B58_u50A8"><span class="toc-number">7.</span> <span class="toc-text">快捷方式的存储</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#u5FEB_u6377_u65B9_u5F0F_u7684_u521B_u5EFA"><span class="toc-number">8.</span> <span class="toc-text">快捷方式的创建</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#u5FEB_u6377_u65B9_u5F0F_u7684_u5224_u65AD_u662F_u5426_u5B58_u5728"><span class="toc-number">9.</span> <span class="toc-text">快捷方式的判断是否存在</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#u4E3A_u4EFB_u610FPackageName_u7684App_u6DFB_u52A0_u5FEB_u6377_u65B9_u5F0F"><span class="toc-number">10.</span> <span class="toc-text">为任意PackageName的App添加快捷方式</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#u521B_u5EFA_u5FEB_u6377_u65B9_u5F0F_u4E4B_u2014_u2014_u661F_u5BBF_u6D3E"><span class="toc-number">11.</span> <span class="toc-text">创建快捷方式之——星宿派</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#u521B_u5EFA_u5FEB_u6377_u65B9_u5F0F_u4E4B_u2014_u2014_u897F_u57DF_u6D3E"><span class="toc-number">12.</span> <span class="toc-text">创建快捷方式之——西域派</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#u5947_u6280PackageManager"><span class="toc-number">13.</span> <span class="toc-text">奇技PackageManager</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#u4E00_u7EDF_u6C5F_u6E56"><span class="toc-number">14.</span> <span class="toc-text">一统江湖</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#ShortcutLib_u4F7F_u7528_u6307_u5357"><span class="toc-number">15.</span> <span class="toc-text">ShortcutLib使用指南</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#u9879_u76EE_u610F_u4E49"><span class="toc-number">16.</span> <span class="toc-text">项目意义</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#u66F4_u65B0_u5FEB_u6377_u65B9_u5F0F"><span class="toc-number">17.</span> <span class="toc-text">更新快捷方式</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#u4E3A_u4EFB_u610FPackageName_u7684App_u6DFB_u52A0_u5FEB_u6377_u65B9_u5F0F-1"><span class="toc-number">18.</span> <span class="toc-text">为任意PackageName的App添加快捷方式</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#u79FB_u9664_u5FEB_u6377_u65B9_u5F0F"><span class="toc-number">19.</span> <span class="toc-text">移除快捷方式</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#u663E_u793A_u9690_u85CFLauncher_u5165_u53E3"><span class="toc-number">20.</span> <span class="toc-text">显示隐藏Launcher入口</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#u4F7F_u7528_u793A_u4F8B"><span class="toc-number">21.</span> <span class="toc-text">使用示例</span></a></li></ol>
		
		</div>
		
		<h1 id="Android_u5FEB_u6377_u65B9_u5F0F_u89E3_u5BC6"><a href="#Android_u5FEB_u6377_u65B9_u5F0F_u89E3_u5BC6" class="headerlink" title="Android快捷方式解密"></a>Android快捷方式解密</h1><p>Android快捷方式作为Android设备的杀手锏技能，一直都是非常重要的一个功能，也正是如此，各种流氓App也不断通过快捷方式霸占着这样一个用户入口。</p>
<p>同时，各大国产ROM和Luncher的崛起，让这个桌面之争变的更加激烈。毕竟大家都只想用户用自己的App资源，所以，现在各大App不仅仅是要抢占入口，同时还要和各大ROM斗智斗勇。本文将对这个快捷方式进行深度解密，同时给出App适配各种ROM的整合方案。</p>
<p>本文很多地方参考了这位朋友的实现：</p>
<p><a href="https://gist.github.com/waylife/437a3d98a84f245b9582" target="_blank" rel="external">https://gist.github.com/waylife/437a3d98a84f245b9582</a></p>
<p>特此表示感谢！</p>
<h1 id="u521B_u5EFA_u5FEB_u6377_u65B9_u5F0F_u4E4B_u2014_u2014_u5C11_u6797_u6D3E"><a href="#u521B_u5EFA_u5FEB_u6377_u65B9_u5F0F_u4E4B_u2014_u2014_u5C11_u6797_u6D3E" class="headerlink" title="创建快捷方式之——少林派"></a>创建快捷方式之——少林派</h1><blockquote>
<p>所谓少林，是指系统正统的解决方法</p>
</blockquote>
<p>天下武功出少林，天下的快捷方式都是Google给的，我们先来看看如何使用Android系统提供的方式来使用Android的快捷方式。</p>
<blockquote>
<p>首先大家要知道各种Launcher的区别，原生的Launcher，是两层结构，桌面是快捷方式，而进去后的App列表是App的Launch Icon；而以小米为首的一帮ROM，参考iOS风格，将Launcher改为了一层，即直接显示Launch Icon。</p>
</blockquote>
<h1 id="u6743_u9650_u8BBE_u7F6E"><a href="#u6743_u9650_u8BBE_u7F6E" class="headerlink" title="权限设置"></a>权限设置</h1><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 添加快捷方式 --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="title">uses-permission</span> <span class="attribute">android:name</span>=<span class="value">"com.android.launcher.permission.INSTALL_SHORTCUT"</span> /&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- 移除快捷方式 --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="title">uses-permission</span> <span class="attribute">android:name</span>=<span class="value">"com.android.launcher.permission.UNINSTALL_SHORTCUT"</span> /&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- 查询快捷方式 --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="title">uses-permission</span> <span class="attribute">android:name</span>=<span class="value">"com.android.launcher.permission.READ_SETTINGS"</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<h1 id="u521B_u5EFA_u5FEB_u6377_u65B9_u5F0F"><a href="#u521B_u5EFA_u5FEB_u6377_u65B9_u5F0F" class="headerlink" title="创建快捷方式"></a>创建快捷方式</h1><p>创建快捷方式的Action：</p>
<figure class="highlight processing"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Action 添加Shortcut</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">String</span> ACTION_ADD_SHORTCUT = <span class="string">"com.android.launcher.action.INSTALL_SHORTCUT"</span>;</span><br></pre></td></tr></table></figure>
<p>通过广播创建快捷方式：<br><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line"> * 添加快捷方式</span><br><span class="line"> *</span><br><span class="line"> * <span class="doctag">@param</span> context      context</span><br><span class="line"> * <span class="doctag">@param</span> actionIntent 要启动的Intent</span><br><span class="line"> * <span class="doctag">@param</span> name         name</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="function"><span class="keyword">void</span> <span class="title">addShortcut</span><span class="params">(Context context, Intent actionIntent, String name,</span><br><span class="line">                               <span class="keyword">boolean</span> allowRepeat, Bitmap iconBitmap)</span> </span>&#123;</span><br><span class="line">    Intent addShortcutIntent = <span class="keyword">new</span> Intent(ACTION_ADD_SHORTCUT);</span><br><span class="line">    <span class="comment">// 是否允许重复创建</span></span><br><span class="line">    addShortcutIntent.putExtra(<span class="string">"duplicate"</span>, allowRepeat);</span><br><span class="line">    <span class="comment">// 快捷方式的标题</span></span><br><span class="line">    addShortcutIntent.putExtra(Intent.EXTRA_SHORTCUT_NAME, name);</span><br><span class="line">    <span class="comment">// 快捷方式的图标</span></span><br><span class="line">    addShortcutIntent.putExtra(Intent.EXTRA_SHORTCUT_ICON, iconBitmap);</span><br><span class="line">    <span class="comment">// 快捷方式的动作</span></span><br><span class="line">    addShortcutIntent.putExtra(Intent.EXTRA_SHORTCUT_INTENT, actionIntent);</span><br><span class="line">    context.sendBroadcast(addShortcutIntent);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>参数相信大家都能看得懂，只是有一点需要注意的，duplicate这个属性，是设置该快捷方式是否允许多次创建的属性，但是，在很多ROM上都不能成功识别，嗯，这就是我们最开始说的快捷方式乱现象。</p>
<h1 id="u5220_u9664_u5FEB_u6377_u65B9_u5F0F"><a href="#u5220_u9664_u5FEB_u6377_u65B9_u5F0F" class="headerlink" title="删除快捷方式"></a>删除快捷方式</h1><p>删除快捷方式的Action：</p>
<figure class="highlight processing"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Action 移除Shortcut</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">String</span> ACTION_REMOVE_SHORTCUT = <span class="string">"com.android.launcher.action.UNINSTALL_SHORTCUT"</span>;</span><br></pre></td></tr></table></figure>
<p>通过广播删除快捷方式：</p>
<figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">/<span class="keyword">*</span><span class="keyword">*</span></span><br><span class="line">   <span class="keyword">*</span> 移除快捷方式</span><br><span class="line">   <span class="keyword">*</span></span><br><span class="line">   <span class="keyword">*</span> <span class="comment">@param context      context</span></span><br><span class="line">   <span class="keyword">*</span> <span class="comment">@param actionIntent 要启动的Intent</span></span><br><span class="line">   <span class="keyword">*</span> <span class="comment">@param name         name</span></span><br><span class="line">   <span class="keyword">*</span>/</span><br><span class="line">  public static void removeShortcut(Context context, Intent actionIntent, String name) &#123;</span><br><span class="line">      Intent intent = new Intent(ACTION_REMOVE_SHORTCUT);</span><br><span class="line">      intent.putExtra(Intent.EXTRA_SHORTCUT_NAME, name);</span><br><span class="line">//        intent.addCategory(Intent.CATEGORY_LAUNCHER);</span><br><span class="line">      intent.putExtra(<span class="string">"duplicate"</span>, false);</span><br><span class="line">      intent.putExtra(Intent.EXTRA_SHORTCUT_INTENT, actionIntent);</span><br><span class="line">      context.sendBroadcast(intent);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>参数与创建快捷方式的方法基本类似，需要注意的是，Intent.EXTRA_SHORTCUT_INTENT，与之前创建快捷方式的Intent必须要是同一个，不然是无法删除快捷方式的。</p>
<h1 id="u521B_u5EFA_u5FEB_u6377_u65B9_u5F0F_u4E4B_u2014_u2014_u900D_u9065_u6D3E"><a href="#u521B_u5EFA_u5FEB_u6377_u65B9_u5F0F_u4E4B_u2014_u2014_u900D_u9065_u6D3E" class="headerlink" title="创建快捷方式之——逍遥派"></a>创建快捷方式之——逍遥派</h1><blockquote>
<p>所谓逍遥派，是指我们从原理来理解如何来适配各种Launcher。</p>
</blockquote>
<p>原生的快捷方式添加方法，虽然是官方提供的，但在天国这样一个怎么说呢的国家里，基本是很难使用、适配的，也就是我们最开始说的那些原因。下面我们先从快捷方式的整个生命周期来了解下产生、添加、删除快捷方式的原理，再来思考如何实现多ROM、Launcher的适配。</p>
<h1 id="u5FEB_u6377_u65B9_u5F0F_u7684_u5B58_u50A8"><a href="#u5FEB_u6377_u65B9_u5F0F_u7684_u5B58_u50A8" class="headerlink" title="快捷方式的存储"></a>快捷方式的存储</h1><p>快捷方式其实都存储在Launcher的数据库中，我们在手机上打开SQLite Editor打开Launcher的数据库。<br><img src="http://7xoz2q.com1.z0.glb.clouddn.com/Android%E5%BF%AB%E6%8D%B7%E6%96%B9%E5%BC%8F1.jpeg" alt=""></p>
<p>我们打开Launcher.db的favorite表，这里就是我们保存的快捷方式数据：<br><img src="http://7xoz2q.com1.z0.glb.clouddn.com/Android%E5%BF%AB%E6%8D%B7%E6%96%B9%E5%BC%8F2.jpeg" alt=""></p>
<p>几个主要的字段大家基本一看就懂：title、intent、iconResource、icon，分别对应快捷方式名称，快捷方式intent，快捷方式图标来源，快捷方式图标二进制数据。</p>
<h1 id="u5FEB_u6377_u65B9_u5F0F_u7684_u521B_u5EFA"><a href="#u5FEB_u6377_u65B9_u5F0F_u7684_u521B_u5EFA" class="headerlink" title="快捷方式的创建"></a>快捷方式的创建</h1><p>了解了快捷方式的存储原理，我们就可以针对这个数据库来做文章，所有的快捷方式都可以通过修改这个数据库来实现，同时还不用太考虑兼容性问题。</p>
<p>对于快捷方式的创建，我们依然可以使用系统提供的方法，所以这里不再多说。</p>
<h1 id="u5FEB_u6377_u65B9_u5F0F_u7684_u5224_u65AD_u662F_u5426_u5B58_u5728"><a href="#u5FEB_u6377_u65B9_u5F0F_u7684_u5224_u65AD_u662F_u5426_u5B58_u5728" class="headerlink" title="快捷方式的判断是否存在"></a>快捷方式的判断是否存在</h1><p>前面我们说了，通过duplicate属性可以区分是否允许创建重复的快捷方式，但是，很多ROM是无法兼容到的，所以，这里我们使用查询Launcher数据库的方式来实现。</p>
<p>我们先来看代码：</p>
<figure class="highlight nimrod"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line">    * 检查快捷方式是否存在 &lt;br/&gt;</span><br><span class="line">    * &lt;font color=red&gt;注意：&lt;/font&gt; 有些手机无法判断是否已经创建过快捷方式&lt;br/&gt;</span><br><span class="line">    * 因此，在创建快捷方式时，请添加&lt;br/&gt;</span><br><span class="line">    * shortcutIntent.putExtra(<span class="string">"duplicate"</span>, <span class="literal">false</span>);// 不允许重复创建&lt;br/&gt;</span><br><span class="line">    * 最好使用&#123;@link <span class="comment">#isShortCutExist(Context, String, Intent)&#125;</span></span><br><span class="line">    * 进行判断，因为可能有些应用生成的快捷方式名称是一样的的&lt;br/&gt;</span><br><span class="line">    */</span><br><span class="line">   public <span class="keyword">static</span> boolean isShortCutExist(<span class="type">Context</span> context, <span class="type">String</span> title) &#123;</span><br><span class="line">       boolean <span class="literal">result</span> = <span class="literal">false</span>;</span><br><span class="line">       <span class="keyword">try</span> &#123;</span><br><span class="line">           <span class="type">ContentResolver</span> cr = context.getContentResolver();</span><br><span class="line">           <span class="type">Uri</span> uri = getUriFromLauncher(context);</span><br><span class="line">           <span class="type">Cursor</span> c = cr.query(uri, new <span class="type">String</span>[]&#123;<span class="string">"title"</span>&#125;, <span class="string">"title=? "</span>, new <span class="type">String</span>[]&#123;title&#125;, null);</span><br><span class="line">           <span class="keyword">if</span> (c != null &amp;&amp; c.getCount() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">               <span class="literal">result</span> = <span class="literal">true</span>;</span><br><span class="line">           &#125;</span><br><span class="line">           <span class="keyword">if</span> (c != null &amp;&amp; !c.isClosed()) &#123;</span><br><span class="line">               c.close();</span><br><span class="line">           &#125;</span><br><span class="line">       &#125; catch (<span class="type">Exception</span> e) &#123;</span><br><span class="line">           <span class="literal">result</span> = <span class="literal">false</span>;</span><br><span class="line">           e.printStackTrace();</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">return</span> <span class="literal">result</span>;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   /**</span><br><span class="line">    * 不一定所有的手机都有效，因为国内大部分手机的桌面不是系统原生的&lt;br/&gt;</span><br><span class="line">    * 更多请参考&#123;@link <span class="comment">#isShortCutExist(Context, String)&#125;&lt;br/&gt;</span></span><br><span class="line">    * 桌面有两种，系统桌面(<span class="type">ROM</span>自带)与第三方桌面，一般只考虑系统自带&lt;br/&gt;</span><br><span class="line">    * 第三方桌面如果没有实现系统响应的方法是无法判断的，比如<span class="type">GO</span>桌面&lt;br/&gt;</span><br><span class="line">    */</span><br><span class="line">   public <span class="keyword">static</span> boolean isShortCutExist(<span class="type">Context</span> context, <span class="type">String</span> title, <span class="type">Intent</span> intent) &#123;</span><br><span class="line">       boolean <span class="literal">result</span> = <span class="literal">false</span>;</span><br><span class="line">       <span class="keyword">try</span> &#123;</span><br><span class="line">           <span class="type">ContentResolver</span> cr = context.getContentResolver();</span><br><span class="line">           <span class="type">Uri</span> uri = getUriFromLauncher(context);</span><br><span class="line">           <span class="type">Cursor</span> c = cr.query(uri, new <span class="type">String</span>[]&#123;<span class="string">"title"</span>, <span class="string">"intent"</span>&#125;, <span class="string">"title=?  and intent=?"</span>,</span><br><span class="line">                   new <span class="type">String</span>[]&#123;title, intent.toUri(<span class="number">0</span>)&#125;, null);</span><br><span class="line">           <span class="keyword">if</span> (c != null &amp;&amp; c.getCount() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">               <span class="literal">result</span> = <span class="literal">true</span>;</span><br><span class="line">           &#125;</span><br><span class="line">           <span class="keyword">if</span> (c != null &amp;&amp; !c.isClosed()) &#123;</span><br><span class="line">               c.close();</span><br><span class="line">           &#125;</span><br><span class="line">       &#125; catch (<span class="type">Exception</span> ex) &#123;</span><br><span class="line">           <span class="literal">result</span> = <span class="literal">false</span>;</span><br><span class="line">           ex.printStackTrace();</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">return</span> <span class="literal">result</span>;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   private <span class="keyword">static</span> <span class="type">Uri</span> getUriFromLauncher(<span class="type">Context</span> context) &#123;</span><br><span class="line">       <span class="type">StringBuilder</span> uriStr = new <span class="type">StringBuilder</span>();</span><br><span class="line">       <span class="type">String</span> authority = <span class="type">LauncherUtil</span>.getAuthorityFromPermissionDefault(context);</span><br><span class="line">       <span class="keyword">if</span> (authority == null || authority.trim().equals(<span class="string">""</span>)) &#123;</span><br><span class="line">           authority = <span class="type">LauncherUtil</span>.getAuthorityFromPermission(context, <span class="type">LauncherUtil</span>.getCurrentLauncherPackageName(context) + <span class="string">".permission.READ_SETTINGS"</span>);</span><br><span class="line">       &#125;</span><br><span class="line">       uriStr.append(<span class="string">"content://"</span>);</span><br><span class="line">       <span class="keyword">if</span> (<span class="type">TextUtils</span>.isEmpty(authority)) &#123;</span><br><span class="line">           <span class="type">int</span> sdkInt = android.os.<span class="type">Build</span>.<span class="type">VERSION</span>.<span class="type">SDK_INT</span>;</span><br><span class="line">           <span class="keyword">if</span> (sdkInt &lt; <span class="number">8</span>) &#123; // <span class="type">Android</span> <span class="number">2</span>.<span class="number">1</span>.x(<span class="type">API</span> <span class="number">7</span>)以及以下的</span><br><span class="line">               uriStr.append(<span class="string">"com.android.launcher.settings"</span>);</span><br><span class="line">           &#125; <span class="keyword">else</span> <span class="keyword">if</span> (sdkInt &lt; <span class="number">19</span>) &#123;// <span class="type">Android</span> <span class="number">4</span>.<span class="number">4</span>以下</span><br><span class="line">               uriStr.append(<span class="string">"com.android.launcher2.settings"</span>);</span><br><span class="line">           &#125; <span class="keyword">else</span> &#123;// <span class="number">4</span>.<span class="number">4</span>以及以上</span><br><span class="line">               uriStr.append(<span class="string">"com.android.launcher3.settings"</span>);</span><br><span class="line">           &#125;</span><br><span class="line">       &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">           uriStr.append(authority);</span><br><span class="line">       &#125;</span><br><span class="line">       uriStr.append(<span class="string">"/favorites?notify=true"</span>);</span><br><span class="line">       <span class="keyword">return</span> <span class="type">Uri</span>.parse(uriStr.toString());</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p>这里有两个重载的isShortCutExist方法，唯一的区别就是最后一个参数——intent，加这个参数的原因，在注释中已经写了，更加精确。而getUriFromLauncher方法，是给调用的ContentResolver提供Uri。构造的时候，可以看见，Android的版本话碎片问题，是多么的严重……</p>
<p>这样在添加快捷方式前，通过这个判断下，就可以只添加一个快捷方式了。</p>
<h1 id="u4E3A_u4EFB_u610FPackageName_u7684App_u6DFB_u52A0_u5FEB_u6377_u65B9_u5F0F"><a href="#u4E3A_u4EFB_u610FPackageName_u7684App_u6DFB_u52A0_u5FEB_u6377_u65B9_u5F0F" class="headerlink" title="为任意PackageName的App添加快捷方式"></a>为任意PackageName的App添加快捷方式</h1><p>知道了我们是如何判断快捷方式是是否存在的，我们就可以通过这种思路来为任意PackageName的App添加快捷方式，代码如下：</p>
<figure class="highlight zephir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line">     * 为PackageName的App添加快捷方式</span><br><span class="line">     *</span><br><span class="line">     * <span class="doctag">@param</span> context context</span><br><span class="line">     * <span class="doctag">@param</span> pkg     待添加快捷方式的应用包名</span><br><span class="line">     * <span class="doctag">@return</span> 返回true为正常执行完毕</span><br><span class="line">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> addShortcutByPackageName(Context context, String pkg) &#123;</span><br><span class="line">        <span class="comment">// 快捷方式名</span></span><br><span class="line">        String title = <span class="string">"unknown"</span>;</span><br><span class="line">        <span class="comment">// MainActivity完整名</span></span><br><span class="line">        String mainAct = <span class="keyword">null</span>;</span><br><span class="line">        <span class="comment">// 应用图标标识</span></span><br><span class="line">        <span class="keyword">int</span> iconIdentifier = <span class="number">0</span>;</span><br><span class="line">        <span class="comment">// 根据包名寻找MainActivity</span></span><br><span class="line">        PackageManager pkgMag = context.getPackageManager();</span><br><span class="line">        Intent queryIntent = <span class="keyword">new</span> Intent(Intent.ACTION_MAIN, <span class="keyword">null</span>);</span><br><span class="line">        queryIntent.addCategory(Intent.CATEGORY_LAUNCHER);<span class="comment">// 重要，添加后可以进入直接已经打开的页面</span></span><br><span class="line">        queryIntent.setFlags(Intent.FLAG_ACTIVITY_RESET_TASK_IF_NEEDED);</span><br><span class="line">        queryIntent.addFlags(Intent.FLAG_ACTIVITY_LAUNCHED_FROM_HISTORY);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">List</span>&lt;ResolveInfo&gt; <span class="keyword">list</span> = pkgMag.queryIntentActivities(queryIntent,</span><br><span class="line">                PackageManager.GET_ACTIVITIES);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="keyword">list</span>.size(); i++) &#123;</span><br><span class="line">            ResolveInfo info = <span class="keyword">list</span>.get(i);</span><br><span class="line">            <span class="keyword">if</span> (info.activityInfo.packageName.equals(pkg)) &#123;</span><br><span class="line">                title = info.loadLabel(pkgMag).toString();</span><br><span class="line">                mainAct = info.activityInfo.name;</span><br><span class="line">                iconIdentifier = info.activityInfo.applicationInfo.icon;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (mainAct == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="comment">// 没有启动类</span></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        Intent shortcut = <span class="keyword">new</span> Intent(</span><br><span class="line">                <span class="string">"com.android.launcher.action.INSTALL_SHORTCUT"</span>);</span><br><span class="line">        <span class="comment">// 快捷方式的名称</span></span><br><span class="line">        shortcut.putExtra(Intent.EXTRA_SHORTCUT_NAME, title);</span><br><span class="line">        <span class="comment">// 不允许重复创建</span></span><br><span class="line">        shortcut.putExtra(<span class="string">"duplicate"</span>, <span class="keyword">false</span>);</span><br><span class="line">        ComponentName comp = <span class="keyword">new</span> ComponentName(pkg, mainAct);</span><br><span class="line">        shortcut.putExtra(Intent.EXTRA_SHORTCUT_INTENT,</span><br><span class="line">                queryIntent.setComponent(comp));</span><br><span class="line">        <span class="comment">// 快捷方式的图标</span></span><br><span class="line">        Context pkgContext = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">if</span> (context.getPackageName().equals(pkg)) &#123;</span><br><span class="line">            pkgContext = context;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 创建第三方应用的上下文环境，为的是能够根据该应用的图标标识符寻找到图标文件。</span></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                pkgContext = context.createPackageContext(pkg,</span><br><span class="line">                        Context.CONTEXT_IGNORE_SECURITY</span><br><span class="line">                                | Context.CONTEXT_INCLUDE_CODE);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (PackageManager.NameNotFoundException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (pkgContext != <span class="keyword">null</span>) &#123;</span><br><span class="line">            Intent.ShortcutIconResource iconRes = Intent.ShortcutIconResource</span><br><span class="line">                    .fromContext(pkgContext, iconIdentifier);</span><br><span class="line">            shortcut.putExtra(Intent.EXTRA_SHORTCUT_ICON_RESOURCE, iconRes);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 发送广播，让接收者创建快捷方式</span></span><br><span class="line">        <span class="comment">// 需权限&lt;uses-permission</span></span><br><span class="line">        <span class="comment">// android:name="com.android.launcher.permission.INSTALL_SHORTCUT" /&gt;</span></span><br><span class="line">        context.sendBroadcast(shortcut);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h1 id="u521B_u5EFA_u5FEB_u6377_u65B9_u5F0F_u4E4B_u2014_u2014_u661F_u5BBF_u6D3E"><a href="#u521B_u5EFA_u5FEB_u6377_u65B9_u5F0F_u4E4B_u2014_u2014_u661F_u5BBF_u6D3E" class="headerlink" title="创建快捷方式之——星宿派"></a>创建快捷方式之——星宿派</h1><p>所谓星宿派，是指我们使用一些Trick来解决多Launcher适配的问题。</p>
<p>由于快捷方式的碎片化非常严重，所以，你顾得上这种ROM，顾不上其它ROM。例如，在原生ROM上，你需要使用类似原生的Launcher权限：</p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;uses-permission android:<span class="property">name</span>=<span class="string">"com.android.launcher.permission.INSTALL_SHORTCUT"</span> /&gt;</span><br><span class="line">&lt;uses-permission android:<span class="property">name</span>=<span class="string">"com.android.launcher.permission.UNINSTALL_SHORTCUT"</span> /&gt;</span><br></pre></td></tr></table></figure>
<p>但是，在其它ROM上呢，例如华为，你需要这样的权限：<br><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;uses-permission android:<span class="property">name</span>=<span class="string">"com.huawei.launcher3.permission.READ_SETTINGS"</span> /&gt;</span><br><span class="line">&lt;uses-permission android:<span class="property">name</span>=<span class="string">"com.huawei.launcher3.permission.WRITE_SETTINGS"</span> /&gt;</span><br></pre></td></tr></table></figure></p>
<p>为了程序能够通用性够强，理论上我们得为所有不使用原生Launcher权限的Launcher配置权限代码，是的，你没  听错，是所有，只有通过这种奇技淫巧，才能适配更多的Launcher，这里贴一部分给大家爽一下：<br><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">&lt;uses-permission android:<span class="property">name</span>=<span class="string">"android.permission.WRITE_EXTERNAL_STORAGE"</span>/&gt;</span><br><span class="line">  &lt;uses-permission android:<span class="property">name</span>=<span class="string">"android.permission.READ_EXTERNAL_STORAGE"</span>/&gt;</span><br><span class="line"></span><br><span class="line">  &lt;uses-permission android:<span class="property">name</span>=<span class="string">"android.permission.WRITE_SETTINGS"</span>/&gt;</span><br><span class="line"></span><br><span class="line">  &lt;uses-permission android:<span class="property">name</span>=<span class="string">"com.android.launcher.permission.INSTALL_SHORTCUT"</span> /&gt;</span><br><span class="line">  &lt;uses-permission android:<span class="property">name</span>=<span class="string">"com.android.launcher.permission.UNINSTALL_SHORTCUT"</span> /&gt;</span><br><span class="line"></span><br><span class="line">  &lt;uses-permission android:<span class="property">name</span>=<span class="string">"com.android.launcher.permission.READ_SETTINGS"</span> /&gt;</span><br><span class="line">  &lt;uses-permission android:<span class="property">name</span>=<span class="string">"com.android.launcher.permission.WRITE_SETTINGS"</span> /&gt;</span><br><span class="line"></span><br><span class="line">  &lt;uses-permission android:<span class="property">name</span>=<span class="string">"com.android.launcher2.permission.READ_SETTINGS"</span> /&gt;</span><br><span class="line">  &lt;uses-permission android:<span class="property">name</span>=<span class="string">"com.android.launcher2.permission.WRITE_SETTINGS"</span> /&gt;</span><br><span class="line"></span><br><span class="line">  &lt;uses-permission android:<span class="property">name</span>=<span class="string">"com.android.launcher3.permission.READ_SETTINGS"</span> /&gt;</span><br><span class="line">  &lt;uses-permission android:<span class="property">name</span>=<span class="string">"com.android.launcher3.permission.WRITE_SETTINGS"</span> /&gt;</span><br><span class="line"></span><br><span class="line">  &lt;uses-permission android:<span class="property">name</span>=<span class="string">"org.adw.launcher.permission.READ_SETTINGS"</span> /&gt;</span><br><span class="line">  &lt;uses-permission android:<span class="property">name</span>=<span class="string">"org.adw.launcher.permission.WRITE_SETTINGS"</span> /&gt;</span><br><span class="line">  &lt;uses-permission android:<span class="property">name</span>=<span class="string">"com.htc.launcher.permission.READ_SETTINGS"</span> /&gt;</span><br><span class="line">  &lt;uses-permission android:<span class="property">name</span>=<span class="string">"com.htc.launcher.permission.WRITE_SETTINGS"</span> /&gt;</span><br><span class="line">  &lt;uses-permission android:<span class="property">name</span>=<span class="string">"com.qihoo360.launcher.permission.READ_SETTINGS"</span> /&gt;</span><br><span class="line">  &lt;uses-permission android:<span class="property">name</span>=<span class="string">"com.qihoo360.launcher.permission.WRITE_SETTINGS"</span> /&gt;</span><br><span class="line">  &lt;uses-permission android:<span class="property">name</span>=<span class="string">"com.lge.launcher.permission.READ_SETTINGS"</span> /&gt;</span><br><span class="line">  &lt;uses-permission android:<span class="property">name</span>=<span class="string">"com.lge.launcher.permission.WRITE_SETTINGS"</span> /&gt;</span><br><span class="line">  &lt;uses-permission android:<span class="property">name</span>=<span class="string">"net.qihoo.launcher.permission.READ_SETTINGS"</span> /&gt;</span><br><span class="line">  &lt;uses-permission android:<span class="property">name</span>=<span class="string">"net.qihoo.launcher.permission.WRITE_SETTINGS"</span> /&gt;</span><br><span class="line">  &lt;uses-permission android:<span class="property">name</span>=<span class="string">"org.adwfreak.launcher.permission.READ_SETTINGS"</span> /&gt;</span><br><span class="line">  &lt;uses-permission android:<span class="property">name</span>=<span class="string">"org.adwfreak.launcher.permission.WRITE_SETTINGS"</span> /&gt;</span><br><span class="line">  &lt;uses-permission android:<span class="property">name</span>=<span class="string">"org.adw.launcher_donut.permission.READ_SETTINGS"</span> /&gt;</span><br><span class="line">  &lt;uses-permission android:<span class="property">name</span>=<span class="string">"org.adw.launcher_donut.permission.WRITE_SETTINGS"</span> /&gt;</span><br><span class="line">  &lt;uses-permission android:<span class="property">name</span>=<span class="string">"com.huawei.launcher3.permission.READ_SETTINGS"</span> /&gt;</span><br><span class="line">  &lt;uses-permission android:<span class="property">name</span>=<span class="string">"com.huawei.launcher3.permission.WRITE_SETTINGS"</span> /&gt;</span><br><span class="line">  &lt;uses-permission android:<span class="property">name</span>=<span class="string">"com.fede.launcher.permission.READ_SETTINGS"</span> /&gt;</span><br><span class="line">  &lt;uses-permission android:<span class="property">name</span>=<span class="string">"com.fede.launcher.permission.WRITE_SETTINGS"</span> /&gt;</span><br><span class="line">  &lt;uses-permission android:<span class="property">name</span>=<span class="string">"com.sec.android.app.twlauncher.settings.READ_SETTINGS"</span> /&gt;</span><br><span class="line">  &lt;uses-permission android:<span class="property">name</span>=<span class="string">"com.sec.android.app.twlauncher.settings.WRITE_SETTINGS"</span> /&gt;</span><br><span class="line">  &lt;uses-permission android:<span class="property">name</span>=<span class="string">"com.anddoes.launcher.permission.READ_SETTINGS"</span> /&gt;</span><br><span class="line">  &lt;uses-permission android:<span class="property">name</span>=<span class="string">"com.anddoes.launcher.permission.WRITE_SETTINGS"</span> /&gt;</span><br><span class="line">  &lt;uses-permission android:<span class="property">name</span>=<span class="string">"com.tencent.qqlauncher.permission.READ_SETTINGS"</span> /&gt;</span><br><span class="line">  &lt;uses-permission android:<span class="property">name</span>=<span class="string">"com.tencent.qqlauncher.permission.WRITE_SETTINGS"</span> /&gt;</span><br><span class="line">  &lt;uses-permission android:<span class="property">name</span>=<span class="string">"com.huawei.launcher2.permission.READ_SETTINGS"</span> /&gt;</span><br><span class="line">  &lt;uses-permission android:<span class="property">name</span>=<span class="string">"com.huawei.launcher2.permission.WRITE_SETTINGS"</span> /&gt;</span><br><span class="line">  &lt;uses-permission android:<span class="property">name</span>=<span class="string">"com.android.mylauncher.permission.READ_SETTINGS"</span> /&gt;</span><br><span class="line">  &lt;uses-permission android:<span class="property">name</span>=<span class="string">"com.android.mylauncher.permission.WRITE_SETTINGS"</span> /&gt;</span><br><span class="line">  &lt;uses-permission android:<span class="property">name</span>=<span class="string">"com.ebproductions.android.launcher.permission.READ_SETTINGS"</span> /&gt;</span><br><span class="line">  &lt;uses-permission android:<span class="property">name</span>=<span class="string">"com.ebproductions.android.launcher.permission.WRITE_SETTINGS"</span> /&gt;</span><br><span class="line">  &lt;uses-permission android:<span class="property">name</span>=<span class="string">"com.oppo.launcher.permission.READ_SETTINGS"</span> /&gt;</span><br><span class="line">  &lt;uses-permission android:<span class="property">name</span>=<span class="string">"com.oppo.launcher.permission.WRITE_SETTINGS"</span> /&gt;</span><br><span class="line">  &lt;uses-permission android:<span class="property">name</span>=<span class="string">"com.miui.mihome2.permission.READ_SETTINGS"</span> /&gt;</span><br><span class="line">  &lt;uses-permission android:<span class="property">name</span>=<span class="string">"com.miui.mihome2.permission.WRITE_SETTINGS"</span> /&gt;</span><br><span class="line">  &lt;uses-permission android:<span class="property">name</span>=<span class="string">"com.huawei.android.launcher.permission.READ_SETTINGS"</span> /&gt;</span><br><span class="line">  &lt;uses-permission android:<span class="property">name</span>=<span class="string">"com.huawei.android.launcher.permission.WRITE_SETTINGS"</span> /&gt;</span><br><span class="line">  &lt;uses-permission android:<span class="property">name</span>=<span class="string">"telecom.mdesk.permission.READ_SETTINGS"</span> /&gt;</span><br><span class="line">  &lt;uses-permission android:<span class="property">name</span>=<span class="string">"telecom.mdesk.permission.WRITE_SETTINGS"</span> /&gt;</span><br><span class="line">  &lt;uses-permission android:<span class="property">name</span>=<span class="string">"dianxin.permission.ACCESS_LAUNCHER_DATA"</span> /&gt;</span><br></pre></td></tr></table></figure></p>
<p>这时候大家肯定要问了，你申请这么多权限，用户在安装App的时候，不是要崩溃了，尼玛，这么多看都看不过来啊，其实，根本不需要担心，因为这些基本都是各自ROM中的第三方ROM权限，在用户安装的时候，他们通常会被解析成原生Launcher的权限，例如：添加、修改桌面快捷方式。并不会将所有的权限都写出来。</p>
<h1 id="u521B_u5EFA_u5FEB_u6377_u65B9_u5F0F_u4E4B_u2014_u2014_u897F_u57DF_u6D3E"><a href="#u521B_u5EFA_u5FEB_u6377_u65B9_u5F0F_u4E4B_u2014_u2014_u897F_u57DF_u6D3E" class="headerlink" title="创建快捷方式之——西域派"></a>创建快捷方式之——西域派</h1><blockquote>
<p>所谓西域派，是因为我想不出其他名字了。西域一派，使用其他方式来实现类似快捷方式的方法。</p>
</blockquote>
<p>快捷方式的确是我们为应用导流的一个非常重要的入口，但是，由于碎片化实在太严重，所以，我们可以使用在Launcher App列表中为应用增加一个入口的方式来为App导流，简单的说，就是增进一个App的入口Activity。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">activity</span> <span class="attribute">android:name</span>=<span class="value">".MainActivity"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">intent-filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">action</span> <span class="attribute">android:name</span>=<span class="value">"android.intent.action.MAIN"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="title">category</span> <span class="attribute">android:name</span>=<span class="value">"android.intent.category.LAUNCHER"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="title">intent-filter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">activity</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="title">activity</span></span><br><span class="line">    <span class="attribute">android:name</span>=<span class="value">"com.hujiang.hj_shortcut_lib.HJShortcutActivity"</span></span><br><span class="line">    <span class="attribute">android:theme</span>=<span class="value">"@style/Base.Theme.AppCompat.Dialog"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">intent-filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">action</span> <span class="attribute">android:name</span>=<span class="value">"android.intent.action.MAIN"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="title">category</span> <span class="attribute">android:name</span>=<span class="value">"android.intent.category.LAUNCHER"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="title">intent-filter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">activity</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>非常简单，相信大家都知道这种方式来给App增加一个Activity入口。但是，这种方式，我们如何能够自由的控制这个入口是否显示呢？</p>
<h1 id="u5947_u6280PackageManager"><a href="#u5947_u6280PackageManager" class="headerlink" title="奇技PackageManager"></a>奇技PackageManager</h1><p>PackageManager提供了一系列Package的管理方法，当然，也包含了我们非常关心的启用、停用组件这一方法，这个方法在Root情况下，可以修改任一App的任意组件，在普通情况下，对自身App有绝对权限。使用方法也非常简单：</p>
<figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="function"><span class="keyword">void</span> <span class="title">toggleFlowEntrance</span><span class="params">(Context context, Class launcherClass)</span> </span>&#123;</span><br><span class="line">       PackageManager packageManager = context.getPackageManager();</span><br><span class="line">       ComponentName componentName = <span class="keyword">new</span> ComponentName(context, launcherClass);</span><br><span class="line">       <span class="keyword">int</span> res = packageManager.getComponentEnabledSetting(componentName);</span><br><span class="line">       <span class="keyword">if</span> (res == PackageManager.COMPONENT_ENABLED_STATE_DEFAULT ||</span><br><span class="line">               res == PackageManager.COMPONENT_ENABLED_STATE_ENABLED) &#123;</span><br><span class="line">           <span class="comment">// 隐藏应用图标</span></span><br><span class="line">           packageManager.setComponentEnabledSetting(</span><br><span class="line">                   componentName,</span><br><span class="line">                   PackageManager.COMPONENT_ENABLED_STATE_DISABLED,</span><br><span class="line">                   PackageManager.DONT_KILL_APP);</span><br><span class="line">       &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">           <span class="comment">// 显示应用图标</span></span><br><span class="line">           packageManager.setComponentEnabledSetting(</span><br><span class="line">                   componentName,</span><br><span class="line">                   PackageManager.COMPONENT_ENABLED_STATE_DEFAULT,</span><br><span class="line">                   PackageManager.DONT_KILL_APP);</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<h1 id="u4E00_u7EDF_u6C5F_u6E56"><a href="#u4E00_u7EDF_u6C5F_u6E56" class="headerlink" title="一统江湖"></a>一统江湖</h1><p>前面我们分析了各种快捷方式、Launcher入口的方式来对App进行导流，当然，这不是我们的目的，我们的目的是能够掌握Android快捷方式的哭花宝典而不用那个啥。</p>
<p>所以，下面我封装了一个shortcut的开源库，从而可以尽可能的忽略ROM的差异，来使用快捷方式和Launcher入口。</p>
<p>项目地址：<br><a href="https://github.com/xuyisheng/ShortcutHelper" target="_blank" rel="external">https://github.com/xuyisheng/ShortcutHelper</a></p>
<p>目前该项目还在测试阶段，还要很多问题和适配bug需要解决，欢迎大家提issue。</p>
<p>README如下：</p>
<h1 id="ShortcutLib_u4F7F_u7528_u6307_u5357"><a href="#ShortcutLib_u4F7F_u7528_u6307_u5357" class="headerlink" title="ShortcutLib使用指南"></a>ShortcutLib使用指南</h1><p>本项目目前还在测试阶段，请大家多提issue，共同完善。</p>
<h1 id="u9879_u76EE_u610F_u4E49"><a href="#u9879_u76EE_u610F_u4E49" class="headerlink" title="项目意义"></a>项目意义</h1><p>快速使用shortcut，避免各种ROM适配导致的各种问题。</p>
<p>#</p>
<ul>
<li>增加快捷方式</li>
</ul>
<figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">/<span class="keyword">*</span><span class="keyword">*</span></span><br><span class="line">   <span class="keyword">*</span> 添加快捷方式</span><br><span class="line">   <span class="keyword">*</span></span><br><span class="line">   <span class="keyword">*</span> <span class="comment">@param context      context</span></span><br><span class="line">   <span class="keyword">*</span> <span class="comment">@param actionIntent 要启动的Intent</span></span><br><span class="line">   <span class="keyword">*</span> <span class="comment">@param name         name</span></span><br><span class="line">   <span class="keyword">*</span> <span class="comment">@param allowRepeat  是否允许重复</span></span><br><span class="line">   <span class="keyword">*</span> <span class="comment">@param iconBitmap   快捷方式图标</span></span><br><span class="line">   <span class="keyword">*</span>/</span><br><span class="line">  public static void addShortcut(Context context, Intent actionIntent, String name,</span><br><span class="line">                                 boolean allowRepeat, Bitmap iconBitmap)</span><br></pre></td></tr></table></figure>
<ul>
<li>判断快捷方式是否存在</li>
</ul>
<p>基础方式</p>
<figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">/<span class="keyword">*</span><span class="keyword">*</span></span><br><span class="line">     <span class="keyword">*</span> 判断快捷方式是否存在</span><br><span class="line">     <span class="keyword">*</span> <span class="variable">&lt;p/&gt;</span></span><br><span class="line">     <span class="keyword">*</span> 检查快捷方式是否存在 <span class="variable">&lt;br/&gt;</span></span><br><span class="line">     <span class="keyword">*</span> <span class="variable">&lt;font color=red&gt;</span>注意：<span class="variable">&lt;/font&gt;</span> 有些手机无法判断是否已经创建过快捷方式<span class="variable">&lt;br/&gt;</span></span><br><span class="line">     <span class="keyword">*</span> 因此，在创建快捷方式时，请添加<span class="variable">&lt;br/&gt;</span></span><br><span class="line">     <span class="keyword">*</span> shortcutIntent.putExtra(<span class="string">"duplicate"</span>, false);// 不允许重复创建<span class="variable">&lt;br/&gt;</span></span><br><span class="line">     <span class="keyword">*</span> 最好使用&#123;<span class="comment">@link #isShortCutExist(Context, String, Intent)&#125;</span></span><br><span class="line">     <span class="keyword">*</span> 进行判断，因为可能有些应用生成的快捷方式名称是一样的的<span class="variable">&lt;br/&gt;</span></span><br><span class="line">     <span class="keyword">*</span></span><br><span class="line">     <span class="keyword">*</span> <span class="comment">@param context context</span></span><br><span class="line">     <span class="keyword">*</span> <span class="comment">@param title   快捷方式名</span></span><br><span class="line">     <span class="keyword">*</span> <span class="comment">@return 是否存在</span></span><br><span class="line">     <span class="keyword">*</span>/</span><br><span class="line">    public static boolean isShortCutExist(Context context, String title)</span><br></pre></td></tr></table></figure>
<p>严格方式（增加Intent的检查）</p>
<figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">/<span class="keyword">*</span><span class="keyword">*</span></span><br><span class="line">    <span class="keyword">*</span> 判断快捷方式是否存在</span><br><span class="line">    <span class="keyword">*</span> <span class="variable">&lt;p/&gt;</span></span><br><span class="line">    <span class="keyword">*</span> 不一定所有的手机都有效，因为国内大部分手机的桌面不是系统原生的<span class="variable">&lt;br/&gt;</span></span><br><span class="line">    <span class="keyword">*</span> 更多请参考&#123;<span class="comment">@link #isShortCutExist(Context, String)&#125;&lt;br/&gt;</span></span><br><span class="line">    <span class="keyword">*</span> 桌面有两种，系统桌面(ROM自带)与第三方桌面，一般只考虑系统自带<span class="variable">&lt;br/&gt;</span></span><br><span class="line">    <span class="keyword">*</span> 第三方桌面如果没有实现系统响应的方法是无法判断的，比如GO桌面<span class="variable">&lt;br/&gt;</span></span><br><span class="line">    <span class="keyword">*</span></span><br><span class="line">    <span class="keyword">*</span> <span class="comment">@param context context</span></span><br><span class="line">    <span class="keyword">*</span> <span class="comment">@param title   快捷方式名</span></span><br><span class="line">    <span class="keyword">*</span> <span class="comment">@param intent  快捷方式Intent</span></span><br><span class="line">    <span class="keyword">*</span> <span class="comment">@return 是否存在</span></span><br><span class="line">    <span class="keyword">*</span>/</span><br><span class="line">   public static boolean isShortCutExist(Context context, String title, Intent intent)</span><br></pre></td></tr></table></figure>
<h1 id="u66F4_u65B0_u5FEB_u6377_u65B9_u5F0F"><a href="#u66F4_u65B0_u5FEB_u6377_u65B9_u5F0F" class="headerlink" title="更新快捷方式"></a>更新快捷方式</h1><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">/<span class="keyword">*</span><span class="keyword">*</span></span><br><span class="line">     <span class="keyword">*</span> 更新桌面快捷方式图标，不一定所有图标都有效(有可能需要系统权限)</span><br><span class="line">     <span class="keyword">*</span></span><br><span class="line">     <span class="keyword">*</span> <span class="comment">@param context context</span></span><br><span class="line">     <span class="keyword">*</span> <span class="comment">@param title   快捷方式名</span></span><br><span class="line">     <span class="keyword">*</span> <span class="comment">@param intent  快捷方式Intent</span></span><br><span class="line">     <span class="keyword">*</span> <span class="comment">@param bitmap  快捷方式Icon</span></span><br><span class="line">     <span class="keyword">*</span>/</span><br><span class="line">    public static void updateShortcutIcon(Context context, String title, Intent intent, Bitmap bitmap)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>需要注意的是，更新快捷方式在很多手机上都不能生效，需要系统权限。可以通过先删除、再新增的方式来实现。</p>
</blockquote>
<h1 id="u4E3A_u4EFB_u610FPackageName_u7684App_u6DFB_u52A0_u5FEB_u6377_u65B9_u5F0F-1"><a href="#u4E3A_u4EFB_u610FPackageName_u7684App_u6DFB_u52A0_u5FEB_u6377_u65B9_u5F0F-1" class="headerlink" title="为任意PackageName的App添加快捷方式"></a>为任意PackageName的App添加快捷方式</h1><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">/<span class="keyword">*</span><span class="keyword">*</span></span><br><span class="line">    <span class="keyword">*</span> 为任意PackageName的App添加快捷方式</span><br><span class="line">    <span class="keyword">*</span></span><br><span class="line">    <span class="keyword">*</span> <span class="comment">@param context context</span></span><br><span class="line">    <span class="keyword">*</span> <span class="comment">@param pkg     待添加快捷方式的应用包名</span></span><br><span class="line">    <span class="keyword">*</span> <span class="comment">@return 返回true为正常执行完毕</span></span><br><span class="line">    <span class="keyword">*</span>/</span><br><span class="line">   public static boolean addShortcutByPackageName(Context context, String pkg)</span><br></pre></td></tr></table></figure>
<h1 id="u79FB_u9664_u5FEB_u6377_u65B9_u5F0F"><a href="#u79FB_u9664_u5FEB_u6377_u65B9_u5F0F" class="headerlink" title="移除快捷方式"></a>移除快捷方式</h1><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">/<span class="keyword">*</span><span class="keyword">*</span></span><br><span class="line">    <span class="keyword">*</span> 移除快捷方式</span><br><span class="line">    <span class="keyword">*</span></span><br><span class="line">    <span class="keyword">*</span> <span class="comment">@param context      context</span></span><br><span class="line">    <span class="keyword">*</span> <span class="comment">@param actionIntent 要启动的Intent</span></span><br><span class="line">    <span class="keyword">*</span> <span class="comment">@param name         name</span></span><br><span class="line">    <span class="keyword">*</span>/</span><br><span class="line">   public static void removeShortcut(Context context, Intent actionIntent, String name)</span><br></pre></td></tr></table></figure>
<h1 id="u663E_u793A_u9690_u85CFLauncher_u5165_u53E3"><a href="#u663E_u793A_u9690_u85CFLauncher_u5165_u53E3" class="headerlink" title="显示隐藏Launcher入口"></a>显示隐藏Launcher入口</h1><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">/<span class="keyword">*</span><span class="keyword">*</span></span><br><span class="line">     <span class="keyword">*</span> 显示\隐藏Launcher入口</span><br><span class="line">     <span class="keyword">*</span></span><br><span class="line">     <span class="keyword">*</span> <span class="comment">@param context       context</span></span><br><span class="line">     <span class="keyword">*</span> <span class="comment">@param launcherClass launcherClass</span></span><br><span class="line">     <span class="keyword">*</span>/</span><br><span class="line">    public static void toggleFlowEntrance(Context context, Class launcherClass)</span><br></pre></td></tr></table></figure>
<p>使用Launcher入口需要在AndroidMainifest文件中注册新增的入口Activity，例如：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">activity</span> <span class="attribute">android:name</span>=<span class="value">".MainActivity"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">intent-filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">action</span> <span class="attribute">android:name</span>=<span class="value">"android.intent.action.MAIN"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="title">category</span> <span class="attribute">android:name</span>=<span class="value">"android.intent.category.LAUNCHER"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="title">intent-filter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">activity</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="title">activity</span></span><br><span class="line">    <span class="attribute">android:name</span>=<span class="value">"com.xxx.xxxxx"</span></span><br><span class="line">    <span class="attribute">android:theme</span>=<span class="value">"@style/Base.Theme.AppCompat.Dialog"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">intent-filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">action</span> <span class="attribute">android:name</span>=<span class="value">"android.intent.action.MAIN"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="title">category</span> <span class="attribute">android:name</span>=<span class="value">"android.intent.category.LAUNCHER"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="title">intent-filter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">activity</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h1 id="u4F7F_u7528_u793A_u4F8B"><a href="#u4F7F_u7528_u793A_u4F8B" class="headerlink" title="使用示例"></a>使用示例</h1><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addShortcutTest</span><span class="params">(View view)</span> </span>&#123;</span><br><span class="line">      <span class="comment">// 系统方式创建</span></span><br><span class="line">      <span class="comment">// ShortcutUtils.addShortcut(this, getShortCutIntent(), mShortcutName);</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">// 创建前判断是否存在</span></span><br><span class="line">      <span class="keyword">if</span> (!ShortcutSuperUtils.isShortCutExist(<span class="keyword">this</span>, mShortcutName, getShortCutIntent())) &#123;</span><br><span class="line">          ShortcutUtils.addShortcut(<span class="keyword">this</span>, getShortCutIntent(), mShortcutName, <span class="literal">false</span>,</span><br><span class="line">                  BitmapFactory.decodeResource(getResources(), com.hujiang.hj_shortcut_lib.R.drawable.ocsplayer));</span><br><span class="line">          finish();</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          Toast.makeText(<span class="keyword">this</span>, <span class="string">"Shortcut is exist!"</span>, Toast.LENGTH_SHORT).show();</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 为某个包创建快捷方式</span></span><br><span class="line">      <span class="comment">// ShortcutSuperUtils.addShortcutByPackageName(this, this.getPackageName());</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">removeShortcutTest</span><span class="params">(View view)</span> </span>&#123;</span><br><span class="line">      ShortcutUtils.removeShortcut(<span class="keyword">this</span>, getShortCutIntent(), mShortcutName);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateShortcutTest</span><span class="params">(View view)</span> </span>&#123;</span><br><span class="line">      ShortcutSuperUtils.updateShortcutIcon(<span class="keyword">this</span>, mShortcutName, getShortCutIntent(),</span><br><span class="line">              BitmapFactory.decodeResource(getResources(), com.hujiang.hj_shortcut_lib.R.mipmap.ic_launcher));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">toggleFlowEntrance</span><span class="params">(View view)</span> </span>&#123;</span><br><span class="line">      FlowEntranceUtil.toggleFlowEntrance(<span class="keyword">this</span>, HJShortcutActivity.<span class="keyword">class</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">private</span> Intent <span class="title">getShortCutIntent</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="comment">// 使用MAIN，可以避免部分手机(比如华为、HTC部分机型)删除应用时无法删除快捷方式的问题</span></span><br><span class="line">      Intent intent = <span class="keyword">new</span> Intent(Intent.ACTION_MAIN);</span><br><span class="line">      intent.addCategory(Intent.CATEGORY_DEFAULT);</span><br><span class="line">      intent.setClass(MainActivity.<span class="keyword">this</span>, HJShortcutActivity.<span class="keyword">class</span>);</span><br><span class="line">      <span class="keyword">return</span> intent;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>转自：<a href="http://www.jianshu.com/p/dc3d04337d00" target="_blank" rel="external">http://www.jianshu.com/p/dc3d04337d00</a></p>
  
	</div>
		<footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/Android/">Android</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/Android快捷方式/">Android快捷方式</a>
  </div>

</div>



	<div class="article-share" id="share">
	
	  <div data-url="http://www.xuanzhangjiong.xyz/2015/11/18/Android快捷方式解密/" data-title="Android快捷方式解密 | TopJohn&#39;Blog" data-tsina="1600625133" class="share clearfix">
	  </div>
	
	</div>


</footer>

   	       
	</article>
	
<nav class="article-nav clearfix">
 
 <div class="prev" >
 <a href="/2015/11/20/学习-React-Native-for-Android：环境搭建/" title="学习 React Native for Android：环境搭建">
  <strong>上一篇：</strong><br/>
  <span>
  学习 React Native for Android：环境搭建</span>
</a>
</div>


<div class="next">
<a href="/2015/11/09/Material-Design风格的应用程序开发总结/"  title="Material Design风格的应用程序开发总结">
 <strong>下一篇：</strong><br/> 
 <span>Material Design风格的应用程序开发总结
</span>
</a>
</div>

</nav>

	
<section id="comments" class="comment">
	<div class="ds-thread" data-thread-key="2015/11/18/Android快捷方式解密/" data-title="Android快捷方式解密" data-url="http://www.xuanzhangjiong.xyz/2015/11/18/Android快捷方式解密/"></div>
</section>


</div>  
      <div class="openaside"><a class="navbutton" href="#" title="显示侧边栏"></a></div>

  <div id="toc" class="toc-aside">
  <strong class="toc-title">文章目录</strong>
 
 <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Android_u5FEB_u6377_u65B9_u5F0F_u89E3_u5BC6"><span class="toc-number">1.</span> <span class="toc-text">Android快捷方式解密</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#u521B_u5EFA_u5FEB_u6377_u65B9_u5F0F_u4E4B_u2014_u2014_u5C11_u6797_u6D3E"><span class="toc-number">2.</span> <span class="toc-text">创建快捷方式之——少林派</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#u6743_u9650_u8BBE_u7F6E"><span class="toc-number">3.</span> <span class="toc-text">权限设置</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#u521B_u5EFA_u5FEB_u6377_u65B9_u5F0F"><span class="toc-number">4.</span> <span class="toc-text">创建快捷方式</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#u5220_u9664_u5FEB_u6377_u65B9_u5F0F"><span class="toc-number">5.</span> <span class="toc-text">删除快捷方式</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#u521B_u5EFA_u5FEB_u6377_u65B9_u5F0F_u4E4B_u2014_u2014_u900D_u9065_u6D3E"><span class="toc-number">6.</span> <span class="toc-text">创建快捷方式之——逍遥派</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#u5FEB_u6377_u65B9_u5F0F_u7684_u5B58_u50A8"><span class="toc-number">7.</span> <span class="toc-text">快捷方式的存储</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#u5FEB_u6377_u65B9_u5F0F_u7684_u521B_u5EFA"><span class="toc-number">8.</span> <span class="toc-text">快捷方式的创建</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#u5FEB_u6377_u65B9_u5F0F_u7684_u5224_u65AD_u662F_u5426_u5B58_u5728"><span class="toc-number">9.</span> <span class="toc-text">快捷方式的判断是否存在</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#u4E3A_u4EFB_u610FPackageName_u7684App_u6DFB_u52A0_u5FEB_u6377_u65B9_u5F0F"><span class="toc-number">10.</span> <span class="toc-text">为任意PackageName的App添加快捷方式</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#u521B_u5EFA_u5FEB_u6377_u65B9_u5F0F_u4E4B_u2014_u2014_u661F_u5BBF_u6D3E"><span class="toc-number">11.</span> <span class="toc-text">创建快捷方式之——星宿派</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#u521B_u5EFA_u5FEB_u6377_u65B9_u5F0F_u4E4B_u2014_u2014_u897F_u57DF_u6D3E"><span class="toc-number">12.</span> <span class="toc-text">创建快捷方式之——西域派</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#u5947_u6280PackageManager"><span class="toc-number">13.</span> <span class="toc-text">奇技PackageManager</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#u4E00_u7EDF_u6C5F_u6E56"><span class="toc-number">14.</span> <span class="toc-text">一统江湖</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#ShortcutLib_u4F7F_u7528_u6307_u5357"><span class="toc-number">15.</span> <span class="toc-text">ShortcutLib使用指南</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#u9879_u76EE_u610F_u4E49"><span class="toc-number">16.</span> <span class="toc-text">项目意义</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#u66F4_u65B0_u5FEB_u6377_u65B9_u5F0F"><span class="toc-number">17.</span> <span class="toc-text">更新快捷方式</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#u4E3A_u4EFB_u610FPackageName_u7684App_u6DFB_u52A0_u5FEB_u6377_u65B9_u5F0F-1"><span class="toc-number">18.</span> <span class="toc-text">为任意PackageName的App添加快捷方式</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#u79FB_u9664_u5FEB_u6377_u65B9_u5F0F"><span class="toc-number">19.</span> <span class="toc-text">移除快捷方式</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#u663E_u793A_u9690_u85CFLauncher_u5165_u53E3"><span class="toc-number">20.</span> <span class="toc-text">显示隐藏Launcher入口</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#u4F7F_u7528_u793A_u4F8B"><span class="toc-number">21.</span> <span class="toc-text">使用示例</span></a></li></ol>
 
  </div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="隐藏侧边栏"></a></div>
<aside class="clearfix">

  
<div class="categorieslist">
	<p class="asidetitle">分类</p>
		<ul>
		
		  
			<li><a href="/categories/Android/" title="Android">Android<sup>9</sup></a></li>
		  
		
		  
			<li><a href="/categories/Git/" title="Git">Git<sup>3</sup></a></li>
		  
		
		  
			<li><a href="/categories/Java/" title="Java">Java<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/MarkDown/" title="MarkDown">MarkDown<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/React-Native/" title="React Native">React Native<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/java/" title="java">java<sup>2</sup></a></li>
		  
		
		  
			<li><a href="/categories/项目经历/作品/" title="作品">作品<sup>2</sup></a></li>
		  
		
		  
			<li><a href="/categories/开源贡献/" title="开源贡献">开源贡献<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/架构/" title="架构">架构<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/生活小记/" title="生活小记">生活小记<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/设计模式/" title="设计模式">设计模式<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/项目经历/" title="项目经历">项目经历<sup>2</sup></a></li>
		  
		
		</ul>
</div>


  
<div class="tagslist">
	<p class="asidetitle">标签</p>
		<ul class="clearfix">
		
			
				<li><a href="/tags/码农必备常识/" title="码农必备常识">码农必备常识<sup>4</sup></a></li>
			
		
			
				<li><a href="/tags/Android进阶优质资源/" title="Android进阶优质资源">Android进阶优质资源<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/创业项目，一个字“累”/" title="创业项目，一个字“累”">创业项目，一个字“累”<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/校园网账号抓取/" title="校园网账号抓取">校园网账号抓取<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/毕业季/" title="毕业季">毕业季<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/作品/" title="作品">作品<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/新技术试水/" title="新技术试水">新技术试水<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/生活感言/" title="生活感言">生活感言<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/单例模式/" title="单例模式">单例模式<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/md5/" title="md5">md5<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/oschina-android-app/" title="oschina-android-app">oschina-android-app<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/Material-Design/" title="Material Design">Material Design<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/常见3种架构/" title="常见3种架构">常见3种架构<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/注解/" title="注解">注解<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/异步事件处理/" title="异步事件处理">异步事件处理<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/调试/" title="调试">调试<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/性能/" title="性能">性能<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/Android快捷方式/" title="Android快捷方式">Android快捷方式<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/常见问题总结/" title="常见问题总结">常见问题总结<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/MVVM/" title="MVVM">MVVM<sup>1</sup></a></li>
			
		
		</ul>
</div>


  <div class="linkslist">
  <p class="asidetitle">友情链接</p>
    <ul>
        
          <li>
            
            	<a href="http://jiajixin.cn/" target="_blank" title="学长的博客">Jason&#39;s Blog</a>
            
          </li>
        
          <li>
            
            	<a href="http://www.changhuiyuan.com/" target="_blank" title="好友的博客">Eric Libaray</a>
            
          </li>
        
    </ul>
</div>

  <div class="rsspart">
	<a href="/atom.xml" target="_blank" title="rss">RSS 订阅</a>
</div>

  <div class="weiboshow">
  <p class="asidetitle">新浪微博</p>
    <iframe width="100%" height="119" class="share_self"  frameborder="0" scrolling="no" src="http://widget.weibo.com/weiboshow/index.php?language=&width=0&height=119&fansRow=2&ptype=1&speed=0&skin=9&isTitle=1&noborder=1&isWeibo=0&isFans=0&uid=1600625133&verifier=b349771a&dpc=1"></iframe>
</div>


</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<section class="info">
		<p> 「一只笨鸟的成长史...」 <br/>
			Better late than never.</p>
	</section>
	 
	<div class="social-font" class="clearfix">
		
		<a href="http://weibo.com/1600625133" target="_blank" class="icon-weibo" title="微博"></a>
		
		
		<a href="https://github.com/TopJohn" target="_blank" class="icon-github" title="github"></a>
		
		
		
		
		
		
		<a href="https://www.douban.com/people/Top-John" target="_blank" class="icon-douban" title="豆瓣"></a>
		
		
		<a href="http://www.zhihu.com/people/shuai-jiong" target="_blank" class="icon-zhihu" title="知乎"></a>
		
		
		<a href="https://plus.google.com/114979210024559900000?rel=author" target="_blank" class="icon-google_plus" title="Google+"></a>
		
		
		<a href="mailto:xzj19922010@163.com" target="_blank" class="icon-email" title="Email Me"></a>
		
	</div>
			
		

		<p class="copyright">
		Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/wuchong/jacman" target="_blank" title="Jacman">Jacman</a> © 2016 
		
		<a href="/about" target="_blank" title="John">John</a>
		
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/jquery.qrcode-0.12.0.min.js"></script>

<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else{
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
      
      $('#toc.toc-aside').css('display', 'none');
        
    }
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  c.click(function(){
    ta.css('display', 'block').addClass('fadeIn');
  });
  o.click(function(){
    ta.css('display', 'none');
  });
  $(window).scroll(function(){
    ta.css("top",Math.max(140,320-$(this).scrollTop()));
  });
});
</script>


<script type="text/javascript">
$(document).ready(function(){ 
  var $this = $('.share'),
      url = $this.attr('data-url'),
      encodedUrl = encodeURIComponent(url),
      title = $this.attr('data-title'),
      tsina = $this.attr('data-tsina'),
      description = $this.attr('description');
  var html = [
  '<div class="hoverqrcode clearfix"></div>',
  '<a class="overlay" id="qrcode"></a>',
  '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
  '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
  '<a href="#qrcode" class="article-share-qrcode" title="微信"></a>',
  '<a href="http://widget.renren.com/dialog/share?resourceUrl=' + encodedUrl + '&srcUrl=' + encodedUrl + '&title=' + title +'" class="article-share-renren" target="_blank" title="人人"></a>',
  '<a href="http://service.weibo.com/share/share.php?title='+title+'&url='+encodedUrl +'&ralateUid='+ tsina +'&searchPic=true&style=number' +'" class="article-share-weibo" target="_blank" title="微博"></a>',
  '<span title="Share to"></span>'
  ].join('');
  $this.append(html);

  $('.hoverqrcode').hide();

  var myWidth = 0;
  function updatehoverqrcode(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
    var qrsize = myWidth > 1024 ? 200:100;
    var options = {render: 'image', size: qrsize, fill: '#2ca6cb', text: url, radius: 0.5, quiet: 1};
    var p = $('.article-share-qrcode').position();
    $('.hoverqrcode').empty().css('width', qrsize).css('height', qrsize)
                          .css('left', p.left-qrsize/2+20).css('top', p.top-qrsize-10)
                          .qrcode(options);
  };
  $(window).resize(function(){
    $('.hoverqrcode').hide();
  });
  $('.article-share-qrcode').click(function(){
    updatehoverqrcode();
    $('.hoverqrcode').toggle();
  });
  $('.article-share-qrcode').hover(function(){}, function(){
      $('.hoverqrcode').hide();
  });
});   
</script>



<script type="text/javascript">
  var duoshuoQuery = {short_name:"John"};
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
    || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
</script> 







<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
}); 
</script>



<!-- Analytics Begin -->





<!-- Analytics End -->

<!-- Totop Begin -->

	<div id="totop">
	<a title="返回顶部"><img src="/img/scrollup.png"/></a>
	</div>
	<script src="/js/totop.js"></script>

<!-- Totop End -->

<!-- MathJax Begin -->
<!-- mathjax config similar to math.stackexchange -->


<!-- MathJax End -->

<!-- Tiny_search Begin -->

<!-- Tiny_search End -->

  </body>
</html>
